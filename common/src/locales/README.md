# Locales

This folder contains the translations files for all projects (`common`, `mobile` and `web`).

## Updating Translations

1. Update `Translations_CBR_main.xlsx` as needed, both online (our current working directory for translations is [here](https://drive.google.com/drive/u/0/folders/18smmZ4-sSGmFQ1XZ3qQtTXE1T4L3R7PD) in the Google dive) as well as in `common/src/locales`. The simplest workflow for this is to update the online spreadsheet, and then download it to replace the current document in the `locales` folder. Note that this filename **must** be exact.

Please also note that the `_COPIED_WARNING` in row 2 of this `xlsx` file does not apply to this file itself, but instead to the `json` files that will be automatically created from it by `update-translations`.

2. Run `npm run update-translations` from the root of `common`. This process makes use of [this](https://github.com/ofcyln/i18n-json-to-xlsx-converter) tool, which may also be manually used to generate individual translation files from xlsx files or vice versa (`npx i18n-json-to-xlsx-converter --convert excelFileFromGoogleDrive.xlsx`)

## Notes on Translations

-   Please do **NOT** edit the json files in this directory directly. Instead, please edit `Translations_CBR_main.xlsx` in this directory and run `npm run update-translations` in `common` to generate the English and Bari translation files in JSON form. This will also regenerate the Typescript interface at `common/src/@types/resources.d.ts` that allows for type-safe i18n keys and interpolation values. This xlsx file is also located in the Google Drive [here](https://docs.google.com/spreadsheets/d/1Q7uZXjmoDg1BjNeMs_eb0iqFGImkr_hC/edit?gid=1831271911#gid=1831271911), which we will use to coordinate with HHA. Please ensure that this uploaded file remains consistent with the version in this directory.
-   After **ANY** translation file has changed, the i18n Typescript Resources interface must be regenerated by running `npm run i18n-generate-ts-interface` in `common` to maintain type-safe keys and interpolation values. Note that this step is performed automatically by `npm run update-translations`.
-   `common` exports an initialization function that takes in an i18n instance as an argument. This function will initialize i18n to contain all translations needed and other configuration.
-   In order for any updated translations to apply to the mobile app, it is necessary to run `npm run refresh-common`.

## Conventions for missing/problematic translations

-   Following with the conventions implicitly set by HHA, several bari translations are marked as `??`. This indicates that HHA was not able to translate the provided english string, or perhaps had outstanding questions for us. Bari 'translations' that are just english text beginning with `&` are **NEW** translation needs that must be requested from HHA.
-   Any english text that is **NOT** prefixed with an `&` in the current bari translation should be seen as an error, reflecting a need for a new translation.

## Rationale for Centralized Translation Files

-   The same phrases are used in numerous projects, so sharing one source file reduces translation work.
-   Some code in `common/` references translations which are loaded by the code in that module, and hence those translations need to be in the `@cbr/commons` package. For example, the translations used in the React components (such as field names) need to be loaded by the `common` module.
-   Some code in `common/` references translations which are loaded by _other_ modules. For example, the form validation code in `common` is written in the `common` module, but it is then executed by the `web` or `mobile` projects, and hence the translations need to be loaded by those modules. Therefore there ends up being a complex set of rules about which translations are needed by which packages.

By having one unified translation source which is copied into each package, it will reduce duplication, confusion, and management effort. The cost is that each component will have translations in its translation file that are unused.

-   In addition, we maintain `Translations_CBR_main.xlsx` as a single source of truth for all translations.
